<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Linux CTF — Day 1</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;margin:24px;max-width:980px}
    .topbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
    .pill{border:1px solid #ddd;border-radius:999px;padding:8px 12px}
    .btn{border:1px solid #ccc;border-radius:12px;padding:10px 14px;cursor:pointer;background:#fff}
    .btn:hover{background:#f6f6f6}
    .card{border:1px solid #ddd;border-radius:16px;padding:16px;margin:14px 0}
    .locked{opacity:.45}
    input{width:100%;padding:10px;border-radius:12px;border:1px solid #ccc;margin-top:10px}
    .ok{color:#1b7f2a;font-weight:700}
    .no{color:#b00020;font-weight:700}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body>

  <h1>Linux CTF — Day 1</h1>
  <div class="topbar">
    <div class="pill"><b>Format:</b> <span class="mono">FLAG{number}</span></div>
    <div class="pill" id="progressPill"><b>Progress:</b> 0/10</div>
    <button class="btn" id="resetBtn" type="button">Reset Progress</button>
  </div>

  <div id="missions"></div>

  <script>
    // Change this if you publish multiple versions
    const STORAGE_KEY = "linux_ctf_day1_v2";

    // Missions: no plaintext flags, only SHA-256 hashes of the correct FLAG{...} string.
    const missions = [
      { title: "1) Hidden Reality",
        text: "How many hidden files exist? Multiply by 11.",
        hash: "e74f54fa5194f77b6e8fdec3c857b637fc16c73f1cc391a0de0ebb2ab025a9f8" // FLAG{33}
      },
      { title: "2) Deep Inside",
        text: "Count the directories in the path maze/a/b/c/d/e (include 'maze'). Multiply by 7.",
        hash: "29a7aa45fa44495b462683c3940d26c7e284d7408f3223b5b53c2ee9cfa64099" // FLAG{42}
      },
      { title: "3) Word Hunter",
        text: "How many files contain the word linux? Multiply by 19.",
        hash: "db49b982837505f62e5b27d18d6b3ee09b92bb7527fb8fd9a7eab82996d3ac49" // FLAG{38}
      },
      { title: "4) Size Matters",
        text: "Find the largest file size (bytes). Subtract 200.",
        hash: "d2433e3783bada060f9cd84f808516049f028ff14a67c37198510102bd4a7cd4" // FLAG{1000}
      },
      { title: "5) Permission Puzzle",
        text: "How many files are NOT readable? Multiply by 17.",
        hash: "14209823df736b3d741fc29d4757698600c55cfa04b2fcfce899e1b1d8d7cf3b" // FLAG{17}
      },
      { title: "6) Dash Trap",
        text: "Count bytes in the file named --data.txt. Multiply by 13.",
        hash: "b70268b92acfdee3133bc63c19f8154528846ed9f83bc086ee29162f6bb5dce2" // FLAG{104}
      },
      { title: "7) Inventory Check",
        text: "Number of files in words/ plus number of files in words/ that contain linux. Multiply by 9.",
        hash: "e81ab833acff6b455dfad96532444a4bd2b25ff71e4273463645f38dd5e344b9" // FLAG{108}
      },
      { title: "8) Line Numbers",
        text: "How many lines are in logs/log.txt? Subtract 20.",
        hash: "426958651517cff37fa922825369e61542d1001e5843c9910f03e2e5ee1eeb02" // FLAG{67}
      },
      { title: "9) Environment Spy",
        text: "Length of the SECRET_VAR value. Multiply by 5.",
        hash: "a139cecee766dcf54439d0682d61e527b8d1da9b08631026db492dd579786ea1" // FLAG{65}
      },
      { title: "10) Final Calculation",
        text: "Add the results from missions 1, 4, and 8.",
        hash: "1eb89b556b6424610d59cc0a7343108e0464bb207e29c752e294b9910828c9eb" // FLAG{1100}
      }
    ];

    async function sha256(str){
      const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
      return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2,"0")).join("");
    }

    function loadSolved(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
      catch { return []; }
    }

    function saveSolved(arr){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    }

    function setProgressPill(solvedCount){
      document.getElementById("progressPill").innerHTML = `<b>Progress:</b> ${solvedCount}/10`;
    }

    function render(){
      const solved = loadSolved();
      setProgressPill(solved.length);

      const wrap = document.getElementById("missions");
      wrap.innerHTML = "";

      missions.forEach((m, i) => {
        const unlocked = (i === 0) || solved.includes(i - 1);
        const done = solved.includes(i);

        const card = document.createElement("div");
        card.className = "card " + (unlocked ? "" : "locked");

        card.innerHTML = `
          <h3>${m.title} ${done ? '<span class="ok">✔</span>' : ''}</h3>
          <p>${m.text}</p>
          ${
            unlocked ? `
              <input id="in_${i}" class="mono" placeholder="FLAG{number}" ${done ? "disabled" : ""} />
              <div class="row">
                <button class="btn" type="button" ${done ? "disabled" : ""} onclick="check(${i})">Submit</button>
                <div id="msg_${i}"></div>
              </div>
            ` : `<p><i>Locked</i></p>`
          }
        `;

        wrap.appendChild(card);
      });
    }

    async function check(i){
      const solved = loadSolved();
      const inputEl = document.getElementById("in_" + i);
      const msgEl = document.getElementById("msg_" + i);
      const val = (inputEl.value || "").trim();

      // Basic format guard (still not a hint—just prevents junk)
      if(!/^FLAG\{\d+\}$/.test(val)){
        msgEl.innerHTML = `<span class="no">Invalid format</span>`;
        return;
      }

      const h = await sha256(val);
      if(h === missions[i].hash){
        if(!solved.includes(i)) solved.push(i);
        saveSolved(solved);
        msgEl.innerHTML = `<span class="ok">Correct</span>`;
        render();
      } else {
        msgEl.innerHTML = `<span class="no">Incorrect</span>`;
      }
    }

    window.check = check;

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      render();
    });

    render();
  </script>
</body>
</html>
